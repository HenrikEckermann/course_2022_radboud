<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Differential abundance analysis | Multi-omic data science with R/Bioconductor</title>
  <meta name="description" content="Course material" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Differential abundance analysis | Multi-omic data science with R/Bioconductor" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course material" />
  <meta name="github-repo" content="microbiome/course_2022_oulu" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Differential abundance analysis | Multi-omic data science with R/Bioconductor" />
  
  <meta name="twitter:description" content="Course material" />
  

<meta name="author" content="University of Oulu &amp; University of Turku" />


<meta name="date" content="2022-04-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beta-diversity.html"/>
<link rel="next" href="study-material.html"/>
<script src="libs/header-attrs-2.11.3/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to microbiome data science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contents-and-learning-goals"><i class="fa fa-check"></i><b>1.1</b> Contents and learning goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#schedule-and-organizers"><i class="fa fa-check"></i><b>1.2</b> Schedule and organizers</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-to-apply"><i class="fa fa-check"></i><b>1.3</b> How to apply</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i><b>1.4</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>2</b> Program</a>
<ul>
<li class="chapter" data-level="2.1" data-path="program.html"><a href="program.html#day-1"><i class="fa fa-check"></i><b>2.1</b> Day 1</a></li>
<li class="chapter" data-level="2.2" data-path="program.html"><a href="program.html#day-2---alpha-diversity"><i class="fa fa-check"></i><b>2.2</b> Day 2 - Alpha diversity</a></li>
<li class="chapter" data-level="2.3" data-path="program.html"><a href="program.html#day-3---beta-diversity"><i class="fa fa-check"></i><b>2.3</b> Day 3 - Beta diversity</a></li>
<li class="chapter" data-level="2.4" data-path="program.html"><a href="program.html#day-4--multi-omics"><i class="fa fa-check"></i><b>2.4</b> Day 4- Multi-omics</a></li>
<li class="chapter" data-level="2.5" data-path="program.html"><a href="program.html#day-5-presentations-closing"><i class="fa fa-check"></i><b>2.5</b> Day 5 : Presentations &amp; closing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>3</b> Getting started</a>
<ul>
<li class="chapter" data-level="3.1" data-path="start.html"><a href="start.html#checklist-before-the-course"><i class="fa fa-check"></i><b>3.1</b> Checklist (before the course)</a></li>
<li class="chapter" data-level="3.2" data-path="start.html"><a href="start.html#support-and-resources"><i class="fa fa-check"></i><b>3.2</b> Support and resources</a></li>
<li class="chapter" data-level="3.3" data-path="start.html"><a href="start.html#installing-and-loading-the-required-r-packages"><i class="fa fa-check"></i><b>3.3</b> Installing and loading the required R packages</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reproducible-reporting-with-rmarkdown.html"><a href="reproducible-reporting-with-rmarkdown.html"><i class="fa fa-check"></i><b>4</b> Reproducible reporting with Rmarkdown</a></li>
<li class="chapter" data-level="5" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html"><i class="fa fa-check"></i><b>5</b> Importing microbiome data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#data-access"><i class="fa fa-check"></i><b>5.1</b> Data access</a></li>
<li class="chapter" data-level="5.2" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#importing-microbiome-data-in-r"><i class="fa fa-check"></i><b>5.2</b> Importing microbiome data in R</a></li>
<li class="chapter" data-level="5.3" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#example-solutions"><i class="fa fa-check"></i><b>5.3</b> Example solutions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html"><i class="fa fa-check"></i><b>6</b> Microbiome data exploration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#data-structure"><i class="fa fa-check"></i><b>6.1</b> Data structure</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#transformations"><i class="fa fa-check"></i><b>6.1.1</b> Transformations</a></li>
<li class="chapter" data-level="6.1.2" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#aggregation"><i class="fa fa-check"></i><b>6.1.2</b> Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#visualization"><i class="fa fa-check"></i><b>6.2</b> Visualization</a></li>
<li class="chapter" data-level="6.3" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#exercises-optional"><i class="fa fa-check"></i><b>6.3</b> Exercises (optional)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="alpha-diversity.html"><a href="alpha-diversity.html"><i class="fa fa-check"></i><b>7</b> Alpha diversity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="alpha-diversity.html"><a href="alpha-diversity.html#visualization-1"><i class="fa fa-check"></i><b>7.1</b> Visualization</a></li>
<li class="chapter" data-level="7.2" data-path="alpha-diversity.html"><a href="alpha-diversity.html#statistical-testing-and-comparisons"><i class="fa fa-check"></i><b>7.2</b> Statistical testing and comparisons</a></li>
<li class="chapter" data-level="7.3" data-path="alpha-diversity.html"><a href="alpha-diversity.html#exercises"><i class="fa fa-check"></i><b>7.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beta-diversity.html"><a href="beta-diversity.html"><i class="fa fa-check"></i><b>8</b> Beta diversity</a>
<ul>
<li class="chapter" data-level="8.1" data-path="beta-diversity.html"><a href="beta-diversity.html#examples-of-pcoa-with-different-settings"><i class="fa fa-check"></i><b>8.1</b> Examples of PCoA with different settings</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-for-asv-level-data-with-bray-curtis"><i class="fa fa-check"></i><b>8.1.1</b> PCoA for ASV-level data with Bray-Curtis</a></li>
<li class="chapter" data-level="8.1.2" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-for-asv-level-data-with-aitchison-distance"><i class="fa fa-check"></i><b>8.1.2</b> PCoA for ASV-level data with Aitchison distance</a></li>
<li class="chapter" data-level="8.1.3" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-aggregated-to-phylum-level"><i class="fa fa-check"></i><b>8.1.3</b> PCoA aggregated to Phylum level</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="beta-diversity.html"><a href="beta-diversity.html#highlighting-external-variables"><i class="fa fa-check"></i><b>8.2</b> Highlighting external variables</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="beta-diversity.html"><a href="beta-diversity.html#discrete-grouping-variable-shown-with-colors"><i class="fa fa-check"></i><b>8.2.1</b> Discrete grouping variable shown with colors</a></li>
<li class="chapter" data-level="8.2.2" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-plot-with-continuous-variable"><i class="fa fa-check"></i><b>8.2.2</b> PCoA plot with continuous variable</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="beta-diversity.html"><a href="beta-diversity.html#estimating-associations-with-an-external-variable"><i class="fa fa-check"></i><b>8.3</b> Estimating associations with an external variable</a></li>
<li class="chapter" data-level="8.4" data-path="beta-diversity.html"><a href="beta-diversity.html#community-typing"><i class="fa fa-check"></i><b>8.4</b> Community typing</a></li>
<li class="chapter" data-level="8.5" data-path="beta-diversity.html"><a href="beta-diversity.html#exercises-1"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html"><i class="fa fa-check"></i><b>9</b> Differential abundance analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#wilcoxon-test"><i class="fa fa-check"></i><b>9.1</b> Wilcoxon test</a></li>
<li class="chapter" data-level="9.2" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#ancom-bc"><i class="fa fa-check"></i><b>9.2</b> ANCOM-BC</a></li>
<li class="chapter" data-level="9.3" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#comparison-of-the-methods"><i class="fa fa-check"></i><b>9.3</b> Comparison of the methods</a></li>
<li class="chapter" data-level="9.4" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#comparison-of-abundance"><i class="fa fa-check"></i><b>9.4</b> Comparison of abundance</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="study-material.html"><a href="study-material.html"><i class="fa fa-check"></i><b>10</b> Study material</a>
<ul>
<li class="chapter" data-level="10.1" data-path="study-material.html"><a href="study-material.html#lecture-slides"><i class="fa fa-check"></i><b>10.1</b> Lecture slides</a></li>
<li class="chapter" data-level="10.2" data-path="study-material.html"><a href="study-material.html#r-programming-resources"><i class="fa fa-check"></i><b>10.2</b> R programming resources</a></li>
<li class="chapter" data-level="10.3" data-path="study-material.html"><a href="study-material.html#resources-for-treesummarizedexperiment"><i class="fa fa-check"></i><b>10.3</b> Resources for TreeSummarizedExperiment</a></li>
<li class="chapter" data-level="10.4" data-path="study-material.html"><a href="study-material.html#resources-for-phyloseq"><i class="fa fa-check"></i><b>10.4</b> Resources for phyloseq</a></li>
<li class="chapter" data-level="10.5" data-path="study-material.html"><a href="study-material.html#further-reading"><i class="fa fa-check"></i><b>10.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="additional-community-typing.html"><a href="additional-community-typing.html"><i class="fa fa-check"></i><b>11</b> Additional Community Typing</a>
<ul>
<li class="chapter" data-level="11.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#community-composition"><i class="fa fa-check"></i><b>11.1</b> Community composition</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#composition-barplot"><i class="fa fa-check"></i><b>11.1.1</b> Composition barplot</a></li>
<li class="chapter" data-level="11.1.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#composition-heatmap"><i class="fa fa-check"></i><b>11.1.2</b> Composition heatmap</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#cluster-into-csts"><i class="fa fa-check"></i><b>11.2</b> Cluster into CSTs</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#elbow-method"><i class="fa fa-check"></i><b>11.2.1</b> Elbow Method</a></li>
<li class="chapter" data-level="11.2.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#silhouette-method"><i class="fa fa-check"></i><b>11.2.2</b> Silhouette Method</a></li>
<li class="chapter" data-level="11.2.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#gap-statistic-method"><i class="fa fa-check"></i><b>11.2.3</b> Gap-Statistic Method</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#holmes-and-mcmurdie-workflow"><i class="fa fa-check"></i><b>11.3</b> Holmes and McMurdie Workflow</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#jensen-shannon-distance"><i class="fa fa-check"></i><b>11.3.1</b> Jensen-Shannon Distance</a></li>
<li class="chapter" data-level="11.3.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#nonmetric-multidimensional-scaling"><i class="fa fa-check"></i><b>11.3.2</b> NonMetric Multidimensional Scaling</a></li>
<li class="chapter" data-level="11.3.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#chi-squared-correspondence-results"><i class="fa fa-check"></i><b>11.3.3</b> Chi-Squared Correspondence Results</a></li>
<li class="chapter" data-level="11.3.4" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bray-curtis-mds"><i class="fa fa-check"></i><b>11.3.4</b> Bray-Curtis MDS</a></li>
<li class="chapter" data-level="11.3.5" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bray-curtis-nmds"><i class="fa fa-check"></i><b>11.3.5</b> Bray-Curtis NMDS</a></li>
<li class="chapter" data-level="11.3.6" data-path="additional-community-typing.html"><a href="additional-community-typing.html#other-distances-from-the-philentropy-package"><i class="fa fa-check"></i><b>11.3.6</b> Other distances from the Philentropy package</a></li>
<li class="chapter" data-level="11.3.7" data-path="additional-community-typing.html"><a href="additional-community-typing.html#add-a-clustering-variable"><i class="fa fa-check"></i><b>11.3.7</b> Add a Clustering Variable</a></li>
<li class="chapter" data-level="11.3.8" data-path="additional-community-typing.html"><a href="additional-community-typing.html#more-clustering"><i class="fa fa-check"></i><b>11.3.8</b> More Clustering</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="additional-community-typing.html"><a href="additional-community-typing.html#cst-analysis"><i class="fa fa-check"></i><b>11.4</b> CST Analysis</a></li>
<li class="chapter" data-level="11.5" data-path="additional-community-typing.html"><a href="additional-community-typing.html#session-info"><i class="fa fa-check"></i><b>11.5</b> Session Info</a></li>
<li class="chapter" data-level="11.6" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bibliography"><i class="fa fa-check"></i><b>11.6</b> Bibliography</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="exercise-solutions.html"><a href="exercise-solutions.html"><i class="fa fa-check"></i><b>12</b> Exercise Solutions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-5"><i class="fa fa-check"></i><b>12.1</b> Section 5</a></li>
<li class="chapter" data-level="12.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-6"><i class="fa fa-check"></i><b>12.2</b> Section 6</a></li>
<li class="chapter" data-level="12.3" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-7"><i class="fa fa-check"></i><b>12.3</b> Section 7</a></li>
<li class="chapter" data-level="12.4" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-8"><i class="fa fa-check"></i><b>12.4</b> Section 8</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="tutorial-aims.html"><a href="tutorial-aims.html"><i class="fa fa-check"></i><b>13</b> Tutorial Aims</a></li>
<li class="chapter" data-level="14" data-path="lab-1.html"><a href="lab-1.html"><i class="fa fa-check"></i><b>14</b> Lab 1</a>
<ul>
<li class="chapter" data-level="14.1" data-path="lab-1.html"><a href="lab-1.html#unsupervised-learning-feature-selection-dimension-reduction"><i class="fa fa-check"></i><b>14.1</b> unsupervised learning: Feature selection &amp; dimension reduction</a></li>
<li class="chapter" data-level="14.2" data-path="lab-1.html"><a href="lab-1.html#load-the-data"><i class="fa fa-check"></i><b>14.2</b> Load the data</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="lab-2.html"><a href="lab-2.html"><i class="fa fa-check"></i><b>15</b> Lab 2</a>
<ul>
<li class="chapter" data-level="15.1" data-path="lab-2.html"><a href="lab-2.html#unsupervised-learning-clustering-visualization"><i class="fa fa-check"></i><b>15.1</b> unsupervised learning: clustering &amp; visualization</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="lab-3.html"><a href="lab-3.html"><i class="fa fa-check"></i><b>16</b> Lab 3</a>
<ul>
<li class="chapter" data-level="16.1" data-path="lab-3.html"><a href="lab-3.html#unsupervised-learninganalysis-and-interpretation"><i class="fa fa-check"></i><b>16.1</b> unsupervised learning:Analysis and interpretation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Multi-omic data science with R/Bioconductor</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-abundance-analysis" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Differential abundance analysis</h1>
<p>Here, we analyse abundances with two different methods: <strong>Wilcoxon test</strong> (CLR),
and <strong>ANCOM-BC</strong>. All of these test statistical differences between groups.
We will analyse Genus level abundances.</p>
<p>We might want to first perform prevalence filtering to reduce the amount of multiple tests. In this particular dataset, all genera pass a prevalence threshold of 10%, therefore, we do not perform filtering.</p>
<div id="wilcoxon-test" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Wilcoxon test</h2>
<p>A Wilcoxon test estimates the difference in an outcome between two groups. It is a
non-parametric alternative to a t-test, which means that the Wilcoxon test
does not make any assumptions about the data.</p>
<p>Let’s first combine the data for the testing purpose.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="differential-abundance-analysis.html#cb165-1" aria-hidden="true"></a><span class="co"># Agglomerates data to Genus level</span></span>
<span id="cb165-2"><a href="differential-abundance-analysis.html#cb165-2" aria-hidden="true"></a>tse_genus &lt;-<span class="st"> </span><span class="kw">agglomerateByRank</span>(tse, <span class="dt">rank =</span> <span class="st">&quot;Genus&quot;</span>)</span>
<span id="cb165-3"><a href="differential-abundance-analysis.html#cb165-3" aria-hidden="true"></a></span>
<span id="cb165-4"><a href="differential-abundance-analysis.html#cb165-4" aria-hidden="true"></a><span class="co"># Perform clr transformation. A Pseudocount of 1 needs to be added, </span></span>
<span id="cb165-5"><a href="differential-abundance-analysis.html#cb165-5" aria-hidden="true"></a><span class="co"># because the data contains zeros and the clr transformation includes a </span></span>
<span id="cb165-6"><a href="differential-abundance-analysis.html#cb165-6" aria-hidden="true"></a><span class="co"># log transformation.</span></span>
<span id="cb165-7"><a href="differential-abundance-analysis.html#cb165-7" aria-hidden="true"></a>tse_genus &lt;-<span class="st"> </span><span class="kw">transformCounts</span>(tse_genus, <span class="dt">method =</span> <span class="st">&quot;clr&quot;</span>, <span class="dt">pseudocount =</span> <span class="dv">1</span>)</span>
<span id="cb165-8"><a href="differential-abundance-analysis.html#cb165-8" aria-hidden="true"></a></span>
<span id="cb165-9"><a href="differential-abundance-analysis.html#cb165-9" aria-hidden="true"></a><span class="co"># Does transpose, so samples are in rows, then creates a data frame.</span></span>
<span id="cb165-10"><a href="differential-abundance-analysis.html#cb165-10" aria-hidden="true"></a>abundance_analysis_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">assay</span>(tse_genus, <span class="st">&quot;clr&quot;</span>)))</span>
<span id="cb165-11"><a href="differential-abundance-analysis.html#cb165-11" aria-hidden="true"></a><span class="co"># We will analyse whether abundances differ depending on the&quot;patient_status&quot;.</span></span>
<span id="cb165-12"><a href="differential-abundance-analysis.html#cb165-12" aria-hidden="true"></a><span class="co"># There are two groups: &quot;ADHD&quot; and &quot;control&quot;. </span></span>
<span id="cb165-13"><a href="differential-abundance-analysis.html#cb165-13" aria-hidden="true"></a><span class="co"># Let&#39;s include that to the data frame.</span></span>
<span id="cb165-14"><a href="differential-abundance-analysis.html#cb165-14" aria-hidden="true"></a>abundance_analysis_data &lt;-<span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb165-15"><a href="differential-abundance-analysis.html#cb165-15" aria-hidden="true"></a>  abundance_analysis_data, </span>
<span id="cb165-16"><a href="differential-abundance-analysis.html#cb165-16" aria-hidden="true"></a>  <span class="dt">patient_status =</span> <span class="kw">colData</span>(tse_genus)<span class="op">$</span>patient_status</span>
<span id="cb165-17"><a href="differential-abundance-analysis.html#cb165-17" aria-hidden="true"></a>)</span></code></pre></div>
<p>Now we can start with the Wilcoxon test. We test all the taxa by looping through columns,
and store individual p-values to a vector. Then we create a data frame from collected
data.</p>
<p>The code below does the Wilcoxon test only for columns that contain abundances,
not for columns that contain patient status.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="differential-abundance-analysis.html#cb166-1" aria-hidden="true"></a>genera &lt;-<span class="st"> </span><span class="kw">names</span>(abundance_analysis_data[, <span class="op">!</span><span class="kw">names</span>(abundance_analysis_data) <span class="op">%in%</span><span class="st"> &quot;patient_status&quot;</span>])</span>
<span id="cb166-2"><a href="differential-abundance-analysis.html#cb166-2" aria-hidden="true"></a></span>
<span id="cb166-3"><a href="differential-abundance-analysis.html#cb166-3" aria-hidden="true"></a>wilcoxon_p &lt;-<span class="st"> </span><span class="kw">c</span>() <span class="co"># Initialize empty vector for p-values</span></span>
<span id="cb166-4"><a href="differential-abundance-analysis.html#cb166-4" aria-hidden="true"></a></span>
<span id="cb166-5"><a href="differential-abundance-analysis.html#cb166-5" aria-hidden="true"></a><span class="co"># Do &quot;for loop&quot; over selected column names</span></span>
<span id="cb166-6"><a href="differential-abundance-analysis.html#cb166-6" aria-hidden="true"></a><span class="cf">for</span> (i <span class="cf">in</span> genera) {</span>
<span id="cb166-7"><a href="differential-abundance-analysis.html#cb166-7" aria-hidden="true"></a></span>
<span id="cb166-8"><a href="differential-abundance-analysis.html#cb166-8" aria-hidden="true"></a>  result &lt;-<span class="st"> </span><span class="kw">wilcox.test</span>(abundance_analysis_data[, i] <span class="op">~</span><span class="st"> </span>patient_status,</span>
<span id="cb166-9"><a href="differential-abundance-analysis.html#cb166-9" aria-hidden="true"></a>                        <span class="dt">data =</span> abundance_analysis_data)</span>
<span id="cb166-10"><a href="differential-abundance-analysis.html#cb166-10" aria-hidden="true"></a>  </span>
<span id="cb166-11"><a href="differential-abundance-analysis.html#cb166-11" aria-hidden="true"></a>  <span class="co"># Stores p-value to the vector with this column name</span></span>
<span id="cb166-12"><a href="differential-abundance-analysis.html#cb166-12" aria-hidden="true"></a>  wilcoxon_p[[i]]  &lt;-<span class="st"> </span>result<span class="op">$</span>p.value</span>
<span id="cb166-13"><a href="differential-abundance-analysis.html#cb166-13" aria-hidden="true"></a></span>
<span id="cb166-14"><a href="differential-abundance-analysis.html#cb166-14" aria-hidden="true"></a>}</span>
<span id="cb166-15"><a href="differential-abundance-analysis.html#cb166-15" aria-hidden="true"></a></span>
<span id="cb166-16"><a href="differential-abundance-analysis.html#cb166-16" aria-hidden="true"></a>wilcoxon_p &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">taxa =</span>  <span class="kw">names</span>(wilcoxon_p),</span>
<span id="cb166-17"><a href="differential-abundance-analysis.html#cb166-17" aria-hidden="true"></a>                         <span class="dt">p_raw =</span> <span class="kw">unlist</span>(wilcoxon_p))</span></code></pre></div>
<p>Multiple tests were performed. These are not independent, so we need
to adjust p-values for multiple testing. Otherwise, we would increase
the chance of a type I error drastically depending on our p-value
threshold. By applying a p-value adjustment, we can keep the false
positive rate at a level that is acceptable. What is acceptable
depends on our research goals. Here we use the fdr method, but there
are several other methods as well.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="differential-abundance-analysis.html#cb167-1" aria-hidden="true"></a>wilcoxon_p<span class="op">$</span>p_adjusted &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(wilcoxon_p<span class="op">$</span>p_raw, <span class="dt">method =</span> <span class="st">&quot;fdr&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="differential-abundance-analysis.html#cb168-1" aria-hidden="true"></a><span class="co"># prepare a dataframe to plot p values</span></span>
<span id="cb168-2"><a href="differential-abundance-analysis.html#cb168-2" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(wilcoxon_p<span class="op">$</span>p_raw, wilcoxon_p<span class="op">$</span>p_adjusted), </span>
<span id="cb168-3"><a href="differential-abundance-analysis.html#cb168-3" aria-hidden="true"></a>                <span class="dt">type=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>, <span class="st">&quot;fdr&quot;</span>),</span>
<span id="cb168-4"><a href="differential-abundance-analysis.html#cb168-4" aria-hidden="true"></a>        <span class="kw">c</span>(<span class="kw">length</span>(wilcoxon_p<span class="op">$</span>p_raw),</span>
<span id="cb168-5"><a href="differential-abundance-analysis.html#cb168-5" aria-hidden="true"></a>          <span class="kw">length</span>(wilcoxon_p<span class="op">$</span>p_adjusted))))</span>
<span id="cb168-6"><a href="differential-abundance-analysis.html#cb168-6" aria-hidden="true"></a></span>
<span id="cb168-7"><a href="differential-abundance-analysis.html#cb168-7" aria-hidden="true"></a><span class="co"># make a histrogram of p values and adjusted p values</span></span>
<span id="cb168-8"><a href="differential-abundance-analysis.html#cb168-8" aria-hidden="true"></a>wilcoxon_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span></span>
<span id="cb168-9"><a href="differential-abundance-analysis.html#cb168-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">fill=</span>type)) <span class="op">+</span></span>
<span id="cb168-10"><a href="differential-abundance-analysis.html#cb168-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;p-value&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>) </span>
<span id="cb168-11"><a href="differential-abundance-analysis.html#cb168-11" aria-hidden="true"></a></span>
<span id="cb168-12"><a href="differential-abundance-analysis.html#cb168-12" aria-hidden="true"></a>wilcoxon_plot</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="08-abundance_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="ancom-bc" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> ANCOM-BC</h2>
<p><a href="https://www.nature.com/articles/s41467-020-17041-7">The analysis of composition of microbiomes with bias correction (ANCOM-BC)</a>
is a recently developed method for differential abundance testing. It is based on an
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4450248/">earlier published approach</a>.
The former version of this method could be recommended as part of several approaches:
A <a href="https://www.biorxiv.org/content/10.1101/2021.05.10.443486v1.full">recent study</a>
compared several mainstream methods and found that among another method, ANCOM produced the most consistent results and is probably a conservative approach. Please note that based on this and other comparisons, no single method can be recommended across all datasets. Rather, it could be recommended to apply several methods and look at the overlap/differences.</p>
<p>As the only method, ANCOM-BC incorporates the so called <em>sampling fraction</em> into the model. The latter term could be empirically estimated by the ratio of the library size to the microbial load. Variations in this sampling fraction would bias differential abundance analyses if ignored. Furthermore, this method provides p-values, and confidence intervals for each taxon.
It also controls the FDR and it is computationally simple to implement.</p>
<p>As we will see below, to obtain results, all that is needed is to pass
a phyloseq object to the <code>ancombc()</code> function. Therefore, below we first convert
our <code>tse</code> object to a <code>phyloseq</code> object. Then, we specify the formula. In this formula, other covariates could potentially be included to adjust for confounding.
Please check the <a href="https://rdrr.io/github/FrederickHuangLin/ANCOMBC/man/ancombc.html">function documentation</a>
to learn about the additional arguments that we specify below. Also, see <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/ANCOMBC/inst/doc/ANCOMBC.html">here</a> for another example for more than 1 group comparison.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="differential-abundance-analysis.html#cb170-1" aria-hidden="true"></a><span class="co"># currently, ancombc requires the phyloseq format, but we can convert this easily</span></span>
<span id="cb170-2"><a href="differential-abundance-analysis.html#cb170-2" aria-hidden="true"></a>pseq &lt;-<span class="st"> </span><span class="kw">makePhyloseqFromTreeSummarizedExperiment</span>(tse)</span>
<span id="cb170-3"><a href="differential-abundance-analysis.html#cb170-3" aria-hidden="true"></a>pseq_genus &lt;-<span class="st"> </span>phyloseq<span class="op">::</span><span class="kw">tax_glom</span>(pseq, <span class="dt">taxrank =</span> <span class="st">&quot;Genus&quot;</span>)</span>
<span id="cb170-4"><a href="differential-abundance-analysis.html#cb170-4" aria-hidden="true"></a></span>
<span id="cb170-5"><a href="differential-abundance-analysis.html#cb170-5" aria-hidden="true"></a>out =<span class="st"> </span><span class="kw">ancombc</span>(</span>
<span id="cb170-6"><a href="differential-abundance-analysis.html#cb170-6" aria-hidden="true"></a>  <span class="dt">phyloseq =</span> pseq_genus, </span>
<span id="cb170-7"><a href="differential-abundance-analysis.html#cb170-7" aria-hidden="true"></a>  <span class="dt">formula =</span> <span class="st">&quot;patient_status&quot;</span>, </span>
<span id="cb170-8"><a href="differential-abundance-analysis.html#cb170-8" aria-hidden="true"></a>  <span class="dt">p_adj_method =</span> <span class="st">&quot;fdr&quot;</span>, </span>
<span id="cb170-9"><a href="differential-abundance-analysis.html#cb170-9" aria-hidden="true"></a>  <span class="dt">zero_cut =</span> <span class="fl">0.90</span>, <span class="co"># by default prevalence filter of 10% is applied</span></span>
<span id="cb170-10"><a href="differential-abundance-analysis.html#cb170-10" aria-hidden="true"></a>  <span class="dt">lib_cut =</span> <span class="dv">0</span>, </span>
<span id="cb170-11"><a href="differential-abundance-analysis.html#cb170-11" aria-hidden="true"></a>  <span class="dt">group =</span> <span class="st">&quot;patient_status&quot;</span>, </span>
<span id="cb170-12"><a href="differential-abundance-analysis.html#cb170-12" aria-hidden="true"></a>  <span class="dt">struc_zero =</span> <span class="ot">TRUE</span>, </span>
<span id="cb170-13"><a href="differential-abundance-analysis.html#cb170-13" aria-hidden="true"></a>  <span class="dt">neg_lb =</span> <span class="ot">TRUE</span>, </span>
<span id="cb170-14"><a href="differential-abundance-analysis.html#cb170-14" aria-hidden="true"></a>  <span class="dt">tol =</span> <span class="fl">1e-5</span>, </span>
<span id="cb170-15"><a href="differential-abundance-analysis.html#cb170-15" aria-hidden="true"></a>  <span class="dt">max_iter =</span> <span class="dv">100</span>, </span>
<span id="cb170-16"><a href="differential-abundance-analysis.html#cb170-16" aria-hidden="true"></a>  <span class="dt">conserve =</span> <span class="ot">TRUE</span>, </span>
<span id="cb170-17"><a href="differential-abundance-analysis.html#cb170-17" aria-hidden="true"></a>  <span class="dt">alpha =</span> <span class="fl">0.05</span>, </span>
<span id="cb170-18"><a href="differential-abundance-analysis.html#cb170-18" aria-hidden="true"></a>  <span class="dt">global =</span> <span class="ot">TRUE</span></span>
<span id="cb170-19"><a href="differential-abundance-analysis.html#cb170-19" aria-hidden="true"></a>)</span>
<span id="cb170-20"><a href="differential-abundance-analysis.html#cb170-20" aria-hidden="true"></a>res &lt;-<span class="st"> </span>out<span class="op">$</span>res</span></code></pre></div>
<p>The object <code>out</code> contains all relevant information. Again, see the
<a href="https://rdrr.io/github/FrederickHuangLin/ANCOMBC/man/ancombc.html">documentation of the function</a>
under <strong>Value</strong> for an explanation of all the output objects. Our question can be answered
by looking at the <code>res</code> object, which now contains dataframes with the coefficients,
standard errors, p-values and q-values. Conveniently, there is a dataframe <code>diff_abn</code>.
Here, we can find all differentially abundant taxa. Below we show the first 6 entries of this dataframe:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="differential-abundance-analysis.html#cb171-1" aria-hidden="true"></a>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(res<span class="op">$</span>diff_abn)) <span class="op">%&gt;%</span><span class="st"> </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>(<span class="st">&quot;striped&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb171-2"><a href="differential-abundance-analysis.html#cb171-2" aria-hidden="true"></a><span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">scroll_box</span>(<span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
patient_statusControl
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
172647198
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
1726478
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
172647201
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
17264798
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
172647195
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
1726472
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
</div>
<p>In total, this method detects 14 differentially abundant taxa.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="differential-abundance-analysis.html#cb172-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Wilcoxon test p-values under 0.05: &quot;</span>, <span class="kw">sum</span>(wilcoxon_p<span class="op">$</span>p_adjusted<span class="op">&lt;</span><span class="fl">0.05</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="st">&quot;/&quot;</span>, <span class="kw">length</span>(wilcoxon_p<span class="op">$</span>p_adjusted)))</span></code></pre></div>
<pre><code>## [1] &quot;Wilcoxon test p-values under 0.05: 2/54&quot;</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="differential-abundance-analysis.html#cb174-1" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;ANCOM p-values under 0.05: &quot;</span>, <span class="kw">sum</span>(out<span class="op">$</span>res<span class="op">$</span>diff_abn<span class="op">$</span>patient_statusControl), <span class="st">&quot;/&quot;</span>, <span class="kw">length</span>(out<span class="op">$</span>res<span class="op">$</span>diff_abn<span class="op">$</span>patient_statusControl)))</span></code></pre></div>
<pre><code>## [1] &quot;ANCOM p-values under 0.05: 14/49&quot;</code></pre>
</div>
<div id="comparison-of-the-methods" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Comparison of the methods</h2>
<p>TO DO: More difference abundance methods are upcoming. Comparison will be made later.</p>
</div>
<div id="comparison-of-abundance" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Comparison of abundance</h2>
<p>In previous steps, we got information which taxa vary between ADHD and control groups.
Let’s plot those taxa in the boxplot, and compare visually if abundances of those taxa
differ in ADHD and control samples. For comparison, let’s plot also taxa that do not
differ between ADHD and control groups.</p>
<p>Let’s first gather data about taxa that have highest p-values.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="differential-abundance-analysis.html#cb176-1" aria-hidden="true"></a><span class="co">#we used the results from the wilcoxn test </span></span>
<span id="cb176-2"><a href="differential-abundance-analysis.html#cb176-2" aria-hidden="true"></a>df &lt;-<span class="st"> </span>wilcoxon_p</span>
<span id="cb176-3"><a href="differential-abundance-analysis.html#cb176-3" aria-hidden="true"></a><span class="co"># renaming row names and taxa column</span></span>
<span id="cb176-4"><a href="differential-abundance-analysis.html#cb176-4" aria-hidden="true"></a>df<span class="op">$</span>taxa &lt;-<span class="st"> </span><span class="kw">rownames</span>(<span class="kw">assay</span>(tse_genus,<span class="st">&quot;clr&quot;</span>))</span>
<span id="cb176-5"><a href="differential-abundance-analysis.html#cb176-5" aria-hidden="true"></a></span>
<span id="cb176-6"><a href="differential-abundance-analysis.html#cb176-6" aria-hidden="true"></a><span class="co"># There are some taxa that do not include Genus level information. They are</span></span>
<span id="cb176-7"><a href="differential-abundance-analysis.html#cb176-7" aria-hidden="true"></a><span class="co"># excluded from analysis.</span></span>
<span id="cb176-8"><a href="differential-abundance-analysis.html#cb176-8" aria-hidden="true"></a><span class="co"># str_detect finds if the pattern is present in values of &quot;taxon&quot; column.</span></span>
<span id="cb176-9"><a href="differential-abundance-analysis.html#cb176-9" aria-hidden="true"></a><span class="co"># Subset is taken, only those rows are included that do not include the pattern.</span></span>
<span id="cb176-10"><a href="differential-abundance-analysis.html#cb176-10" aria-hidden="true"></a>df &lt;-<span class="st"> </span>df[ <span class="op">!</span>stringr<span class="op">::</span><span class="kw">str_detect</span>(df<span class="op">$</span>taxa, <span class="st">&quot;Genus:uncultured&quot;</span>), ]</span>
<span id="cb176-11"><a href="differential-abundance-analysis.html#cb176-11" aria-hidden="true"></a></span>
<span id="cb176-12"><a href="differential-abundance-analysis.html#cb176-12" aria-hidden="true"></a><span class="co"># Sorts p-values in decreasing order. Takes 3 first ones. Takes those rows that match</span></span>
<span id="cb176-13"><a href="differential-abundance-analysis.html#cb176-13" aria-hidden="true"></a><span class="co"># with p-values. Takes taxa. </span></span>
<span id="cb176-14"><a href="differential-abundance-analysis.html#cb176-14" aria-hidden="true"></a>highest3 &lt;-<span class="st"> </span>df[df<span class="op">$</span>p_adjusted <span class="op">%in%</span><span class="st"> </span><span class="kw">sort</span>(df<span class="op">$</span>p_adjusted, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], ]<span class="op">$</span>taxa</span>
<span id="cb176-15"><a href="differential-abundance-analysis.html#cb176-15" aria-hidden="true"></a></span>
<span id="cb176-16"><a href="differential-abundance-analysis.html#cb176-16" aria-hidden="true"></a><span class="co"># From clr transformed table, takes only those taxa that had highest p-values</span></span>
<span id="cb176-17"><a href="differential-abundance-analysis.html#cb176-17" aria-hidden="true"></a>highest3 &lt;-<span class="st"> </span><span class="kw">assay</span>(tse_genus, <span class="st">&quot;clr&quot;</span>)[highest3, ]</span>
<span id="cb176-18"><a href="differential-abundance-analysis.html#cb176-18" aria-hidden="true"></a></span>
<span id="cb176-19"><a href="differential-abundance-analysis.html#cb176-19" aria-hidden="true"></a><span class="co"># Transposes the table</span></span>
<span id="cb176-20"><a href="differential-abundance-analysis.html#cb176-20" aria-hidden="true"></a>highest3 &lt;-<span class="st"> </span><span class="kw">t</span>(highest3)</span>
<span id="cb176-21"><a href="differential-abundance-analysis.html#cb176-21" aria-hidden="true"></a></span>
<span id="cb176-22"><a href="differential-abundance-analysis.html#cb176-22" aria-hidden="true"></a><span class="co"># Adds colData that includes patient status infomation</span></span>
<span id="cb176-23"><a href="differential-abundance-analysis.html#cb176-23" aria-hidden="true"></a>highest3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(highest3, <span class="kw">as.data.frame</span>(<span class="kw">colData</span>(tse_genus)))</span>
<span id="cb176-24"><a href="differential-abundance-analysis.html#cb176-24" aria-hidden="true"></a></span>
<span id="cb176-25"><a href="differential-abundance-analysis.html#cb176-25" aria-hidden="true"></a><span class="co"># Some taxa names are that long that they don&#39;t fit nicely into title. So let&#39;s add there </span></span>
<span id="cb176-26"><a href="differential-abundance-analysis.html#cb176-26" aria-hidden="true"></a><span class="co"># a line break after e.g. &quot;Genus&quot;. Here the dot after e.g. Genus is replaced with </span></span>
<span id="cb176-27"><a href="differential-abundance-analysis.html#cb176-27" aria-hidden="true"></a><span class="co"># &quot;: \n&quot;</span></span>
<span id="cb176-28"><a href="differential-abundance-analysis.html#cb176-28" aria-hidden="true"></a><span class="kw">colnames</span>(highest3)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(highest3)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="cf">function</span>(x){</span>
<span id="cb176-29"><a href="differential-abundance-analysis.html#cb176-29" aria-hidden="true"></a>  <span class="co"># Replaces the first dot</span></span>
<span id="cb176-30"><a href="differential-abundance-analysis.html#cb176-30" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_replace</span>(x, <span class="st">&quot;[.]&quot;</span>, <span class="st">&quot;: &quot;</span>)</span>
<span id="cb176-31"><a href="differential-abundance-analysis.html#cb176-31" aria-hidden="true"></a>  </span>
<span id="cb176-32"><a href="differential-abundance-analysis.html#cb176-32" aria-hidden="true"></a>  <span class="co"># Replace all other dots and underscores with space</span></span>
<span id="cb176-33"><a href="differential-abundance-analysis.html#cb176-33" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_replace_all</span>(temp, <span class="kw">c</span>(<span class="st">&quot;[.]&quot;</span> =<span class="st"> &quot; &quot;</span>, <span class="st">&quot;_&quot;</span> =<span class="st"> &quot; &quot;</span>))</span>
<span id="cb176-34"><a href="differential-abundance-analysis.html#cb176-34" aria-hidden="true"></a>  </span>
<span id="cb176-35"><a href="differential-abundance-analysis.html#cb176-35" aria-hidden="true"></a>  <span class="co"># Adds line break so that 25 characters is the maximal width</span></span>
<span id="cb176-36"><a href="differential-abundance-analysis.html#cb176-36" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_wrap</span>(temp, <span class="dt">width =</span> <span class="dv">25</span>)</span>
<span id="cb176-37"><a href="differential-abundance-analysis.html#cb176-37" aria-hidden="true"></a>})</span></code></pre></div>
<p>Next, let’s do the same but for taxa with lowest p-values.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="differential-abundance-analysis.html#cb177-1" aria-hidden="true"></a><span class="co"># Sorts p-values in increasing order. Takes 3rd first ones. Takes those rows that match</span></span>
<span id="cb177-2"><a href="differential-abundance-analysis.html#cb177-2" aria-hidden="true"></a><span class="co"># with p-values. Takes taxa. </span></span>
<span id="cb177-3"><a href="differential-abundance-analysis.html#cb177-3" aria-hidden="true"></a>lowest3 &lt;-<span class="st"> </span>df[df<span class="op">$</span>p_adjusted <span class="op">%in%</span><span class="st"> </span><span class="kw">sort</span>(df<span class="op">$</span>p_adjusted, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], ]<span class="op">$</span>taxa</span>
<span id="cb177-4"><a href="differential-abundance-analysis.html#cb177-4" aria-hidden="true"></a></span>
<span id="cb177-5"><a href="differential-abundance-analysis.html#cb177-5" aria-hidden="true"></a></span>
<span id="cb177-6"><a href="differential-abundance-analysis.html#cb177-6" aria-hidden="true"></a><span class="co"># From clr transformed table, takes only those taxa that had lowest p-values</span></span>
<span id="cb177-7"><a href="differential-abundance-analysis.html#cb177-7" aria-hidden="true"></a>lowest3 &lt;-<span class="kw">assay</span>(tse_genus, <span class="st">&quot;clr&quot;</span>)[lowest3, ]</span>
<span id="cb177-8"><a href="differential-abundance-analysis.html#cb177-8" aria-hidden="true"></a></span>
<span id="cb177-9"><a href="differential-abundance-analysis.html#cb177-9" aria-hidden="true"></a><span class="co"># Transposes the table</span></span>
<span id="cb177-10"><a href="differential-abundance-analysis.html#cb177-10" aria-hidden="true"></a>lowest3 &lt;-<span class="st"> </span><span class="kw">t</span>(lowest3)</span>
<span id="cb177-11"><a href="differential-abundance-analysis.html#cb177-11" aria-hidden="true"></a></span>
<span id="cb177-12"><a href="differential-abundance-analysis.html#cb177-12" aria-hidden="true"></a><span class="co"># Adds colData that includes patient status infomation</span></span>
<span id="cb177-13"><a href="differential-abundance-analysis.html#cb177-13" aria-hidden="true"></a>lowest3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(lowest3, <span class="kw">as.data.frame</span>(<span class="kw">colData</span>(tse_genus)))</span>
<span id="cb177-14"><a href="differential-abundance-analysis.html#cb177-14" aria-hidden="true"></a></span>
<span id="cb177-15"><a href="differential-abundance-analysis.html#cb177-15" aria-hidden="true"></a><span class="co"># Some taxa names are that long that they don&#39;t fit nicely into title. So let&#39;s add there </span></span>
<span id="cb177-16"><a href="differential-abundance-analysis.html#cb177-16" aria-hidden="true"></a><span class="co"># a line break after e.g. &quot;Genus&quot;. Here the dot after e.g. Genus is replaced with </span></span>
<span id="cb177-17"><a href="differential-abundance-analysis.html#cb177-17" aria-hidden="true"></a><span class="co"># &quot;: \n&quot;</span></span>
<span id="cb177-18"><a href="differential-abundance-analysis.html#cb177-18" aria-hidden="true"></a><span class="kw">colnames</span>(lowest3)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">colnames</span>(lowest3)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="cf">function</span>(x){</span>
<span id="cb177-19"><a href="differential-abundance-analysis.html#cb177-19" aria-hidden="true"></a>  <span class="co"># Replaces the first dot</span></span>
<span id="cb177-20"><a href="differential-abundance-analysis.html#cb177-20" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_replace</span>(x, <span class="st">&quot;[.]&quot;</span>, <span class="st">&quot;: &quot;</span>)</span>
<span id="cb177-21"><a href="differential-abundance-analysis.html#cb177-21" aria-hidden="true"></a>  </span>
<span id="cb177-22"><a href="differential-abundance-analysis.html#cb177-22" aria-hidden="true"></a>  <span class="co"># Replace all other dots and underscores with space</span></span>
<span id="cb177-23"><a href="differential-abundance-analysis.html#cb177-23" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_replace_all</span>(temp, <span class="kw">c</span>(<span class="st">&quot;[.]&quot;</span> =<span class="st"> &quot; &quot;</span>, <span class="st">&quot;_&quot;</span> =<span class="st"> &quot; &quot;</span>))</span>
<span id="cb177-24"><a href="differential-abundance-analysis.html#cb177-24" aria-hidden="true"></a>  </span>
<span id="cb177-25"><a href="differential-abundance-analysis.html#cb177-25" aria-hidden="true"></a>  <span class="co"># Adds line break so that 25 characters is the maximal width</span></span>
<span id="cb177-26"><a href="differential-abundance-analysis.html#cb177-26" aria-hidden="true"></a>  temp &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_wrap</span>(temp, <span class="dt">width =</span> <span class="dv">25</span>)</span>
<span id="cb177-27"><a href="differential-abundance-analysis.html#cb177-27" aria-hidden="true"></a>})</span></code></pre></div>
<p>Then we can plot these six different taxa. Let’s arrange them into the same picture.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="differential-abundance-analysis.html#cb178-1" aria-hidden="true"></a><span class="co"># Puts plots in the same picture</span></span>
<span id="cb178-2"><a href="differential-abundance-analysis.html#cb178-2" aria-hidden="true"></a>gridExtra<span class="op">::</span><span class="kw">grid.arrange</span>(</span>
<span id="cb178-3"><a href="differential-abundance-analysis.html#cb178-3" aria-hidden="true"></a>  </span>
<span id="cb178-4"><a href="differential-abundance-analysis.html#cb178-4" aria-hidden="true"></a>  <span class="co"># Plot 1</span></span>
<span id="cb178-5"><a href="differential-abundance-analysis.html#cb178-5" aria-hidden="true"></a>  <span class="kw">ggplot</span>(highest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> highest3[,<span class="dv">1</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-6"><a href="differential-abundance-analysis.html#cb178-6" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-7"><a href="differential-abundance-analysis.html#cb178-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-8"><a href="differential-abundance-analysis.html#cb178-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(highest3)[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-9"><a href="differential-abundance-analysis.html#cb178-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-10"><a href="differential-abundance-analysis.html#cb178-10" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-11"><a href="differential-abundance-analysis.html#cb178-11" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-12"><a href="differential-abundance-analysis.html#cb178-12" aria-hidden="true"></a>  </span>
<span id="cb178-13"><a href="differential-abundance-analysis.html#cb178-13" aria-hidden="true"></a>  <span class="co"># Plot 2</span></span>
<span id="cb178-14"><a href="differential-abundance-analysis.html#cb178-14" aria-hidden="true"></a>  <span class="kw">ggplot</span>(highest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> highest3[,<span class="dv">2</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-15"><a href="differential-abundance-analysis.html#cb178-15" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-16"><a href="differential-abundance-analysis.html#cb178-16" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-17"><a href="differential-abundance-analysis.html#cb178-17" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(highest3)[<span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-18"><a href="differential-abundance-analysis.html#cb178-18" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-19"><a href="differential-abundance-analysis.html#cb178-19" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-20"><a href="differential-abundance-analysis.html#cb178-20" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-21"><a href="differential-abundance-analysis.html#cb178-21" aria-hidden="true"></a>  </span>
<span id="cb178-22"><a href="differential-abundance-analysis.html#cb178-22" aria-hidden="true"></a>  <span class="co"># Plot 3</span></span>
<span id="cb178-23"><a href="differential-abundance-analysis.html#cb178-23" aria-hidden="true"></a>  <span class="kw">ggplot</span>(highest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> highest3[,<span class="dv">3</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-24"><a href="differential-abundance-analysis.html#cb178-24" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-25"><a href="differential-abundance-analysis.html#cb178-25" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-26"><a href="differential-abundance-analysis.html#cb178-26" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(highest3)[<span class="dv">3</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-27"><a href="differential-abundance-analysis.html#cb178-27" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-28"><a href="differential-abundance-analysis.html#cb178-28" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-29"><a href="differential-abundance-analysis.html#cb178-29" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-30"><a href="differential-abundance-analysis.html#cb178-30" aria-hidden="true"></a>  </span>
<span id="cb178-31"><a href="differential-abundance-analysis.html#cb178-31" aria-hidden="true"></a>  <span class="co"># Plot 4</span></span>
<span id="cb178-32"><a href="differential-abundance-analysis.html#cb178-32" aria-hidden="true"></a>  <span class="kw">ggplot</span>(lowest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> lowest3[,<span class="dv">1</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-33"><a href="differential-abundance-analysis.html#cb178-33" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-34"><a href="differential-abundance-analysis.html#cb178-34" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-35"><a href="differential-abundance-analysis.html#cb178-35" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(lowest3)[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-36"><a href="differential-abundance-analysis.html#cb178-36" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-37"><a href="differential-abundance-analysis.html#cb178-37" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-38"><a href="differential-abundance-analysis.html#cb178-38" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-39"><a href="differential-abundance-analysis.html#cb178-39" aria-hidden="true"></a>  </span>
<span id="cb178-40"><a href="differential-abundance-analysis.html#cb178-40" aria-hidden="true"></a>  <span class="co"># Plot 5</span></span>
<span id="cb178-41"><a href="differential-abundance-analysis.html#cb178-41" aria-hidden="true"></a>  <span class="kw">ggplot</span>(lowest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> lowest3[,<span class="dv">2</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-42"><a href="differential-abundance-analysis.html#cb178-42" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-43"><a href="differential-abundance-analysis.html#cb178-43" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-44"><a href="differential-abundance-analysis.html#cb178-44" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(lowest3)[<span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-45"><a href="differential-abundance-analysis.html#cb178-45" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-46"><a href="differential-abundance-analysis.html#cb178-46" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-47"><a href="differential-abundance-analysis.html#cb178-47" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-48"><a href="differential-abundance-analysis.html#cb178-48" aria-hidden="true"></a>  </span>
<span id="cb178-49"><a href="differential-abundance-analysis.html#cb178-49" aria-hidden="true"></a>  <span class="co"># Plot 6</span></span>
<span id="cb178-50"><a href="differential-abundance-analysis.html#cb178-50" aria-hidden="true"></a>  <span class="kw">ggplot</span>(lowest3, <span class="kw">aes</span>(<span class="dt">x =</span> patient_status, <span class="dt">y =</span> lowest3[,<span class="dv">3</span>])) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-51"><a href="differential-abundance-analysis.html#cb178-51" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-52"><a href="differential-abundance-analysis.html#cb178-52" aria-hidden="true"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;CLR abundances&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># y axis title</span></span>
<span id="cb178-53"><a href="differential-abundance-analysis.html#cb178-53" aria-hidden="true"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">names</span>(lowest3)[<span class="dv">3</span>]) <span class="op">+</span><span class="st"> </span><span class="co"># main title</span></span>
<span id="cb178-54"><a href="differential-abundance-analysis.html#cb178-54" aria-hidden="true"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-55"><a href="differential-abundance-analysis.html#cb178-55" aria-hidden="true"></a>          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),</span>
<span id="cb178-56"><a href="differential-abundance-analysis.html#cb178-56" aria-hidden="true"></a>          <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()), <span class="co"># makes titles smaller, removes x axis title</span></span>
<span id="cb178-57"><a href="differential-abundance-analysis.html#cb178-57" aria-hidden="true"></a>  </span>
<span id="cb178-58"><a href="differential-abundance-analysis.html#cb178-58" aria-hidden="true"></a>  <span class="co"># 3 columns and 2 rows</span></span>
<span id="cb178-59"><a href="differential-abundance-analysis.html#cb178-59" aria-hidden="true"></a>  <span class="dt">ncol =</span> <span class="dv">3</span>, </span>
<span id="cb178-60"><a href="differential-abundance-analysis.html#cb178-60" aria-hidden="true"></a>  <span class="dt">nrow =</span> <span class="dv">2</span></span>
<span id="cb178-61"><a href="differential-abundance-analysis.html#cb178-61" aria-hidden="true"></a>)</span></code></pre></div>
<p><img src="08-abundance_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>We plotted those taxa that have the highest and lowest p values according to DESeq2. Can you create a plot that shows the difference in abundance in "[Ruminococcus]_gauvreauii_group", which is the other taxon that was identified by all tools. Try for yourself! Below you find one way how to do it.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="differential-abundance-analysis.html#cb179-1" aria-hidden="true"></a><span class="kw">select</span>(</span>
<span id="cb179-2"><a href="differential-abundance-analysis.html#cb179-2" aria-hidden="true"></a>  abundance_analysis_data, </span>
<span id="cb179-3"><a href="differential-abundance-analysis.html#cb179-3" aria-hidden="true"></a>  patient_status, </span>
<span id="cb179-4"><a href="differential-abundance-analysis.html#cb179-4" aria-hidden="true"></a>  <span class="dt">Ruminococcus_gauvreauii_group =</span> <span class="kw">contains</span>(<span class="st">&quot;gauvreauii_group&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb179-5"><a href="differential-abundance-analysis.html#cb179-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(patient_status, Ruminococcus_gauvreauii_group)) <span class="op">+</span></span>
<span id="cb179-6"><a href="differential-abundance-analysis.html#cb179-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="08-abundance_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beta-diversity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="study-material.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["oulu2022_material.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
