<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Beta diversity | Multi-omic data science with R/Bioconductor</title>
  <meta name="description" content="Course material" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Beta diversity | Multi-omic data science with R/Bioconductor" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course material" />
  <meta name="github-repo" content="microbiome/course_2022_oulu" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Beta diversity | Multi-omic data science with R/Bioconductor" />
  
  <meta name="twitter:description" content="Course material" />
  

<meta name="author" content="University of Oulu &amp; University of Turku" />


<meta name="date" content="2022-04-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="alpha-diversity.html"/>
<link rel="next" href="differential-abundance-analysis.html"/>
<script src="libs/header-attrs-2.11.3/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to microbiome data science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contents-and-learning-goals"><i class="fa fa-check"></i><b>1.1</b> Contents and learning goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#schedule-and-organizers"><i class="fa fa-check"></i><b>1.2</b> Schedule and organizers</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-to-apply"><i class="fa fa-check"></i><b>1.3</b> How to apply</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="overview-1.html"><a href="overview-1.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview-1.html"><a href="overview-1.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="overview-1.html"><a href="overview-1.html#learning-goals"><i class="fa fa-check"></i><b>2.2</b> Learning goals</a></li>
<li class="chapter" data-level="2.3" data-path="overview-1.html"><a href="overview-1.html#schedule"><i class="fa fa-check"></i><b>2.3</b> Schedule</a></li>
<li class="chapter" data-level="2.4" data-path="overview-1.html"><a href="overview-1.html#material"><i class="fa fa-check"></i><b>2.4</b> Material</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="organizers.html"><a href="organizers.html"><i class="fa fa-check"></i><b>3</b> Organizers</a>
<ul>
<li class="chapter" data-level="3.1" data-path="organizers.html"><a href="organizers.html#acknowledgments"><i class="fa fa-check"></i><b>3.1</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>4</b> Program</a>
<ul>
<li class="chapter" data-level="4.1" data-path="program.html"><a href="program.html#day-1"><i class="fa fa-check"></i><b>4.1</b> Day 1</a></li>
<li class="chapter" data-level="4.2" data-path="program.html"><a href="program.html#day-2---alpha-diversity"><i class="fa fa-check"></i><b>4.2</b> Day 2 - Alpha diversity</a></li>
<li class="chapter" data-level="4.3" data-path="program.html"><a href="program.html#day-3---beta-diversity"><i class="fa fa-check"></i><b>4.3</b> Day 3 - Beta diversity</a></li>
<li class="chapter" data-level="4.4" data-path="program.html"><a href="program.html#day-4--multi-omics"><i class="fa fa-check"></i><b>4.4</b> Day 4- Multi-omics</a></li>
<li class="chapter" data-level="4.5" data-path="program.html"><a href="program.html#day-5-presentations-closing"><i class="fa fa-check"></i><b>4.5</b> Day 5 : Presentations &amp; closing</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>5</b> Getting started</a>
<ul>
<li class="chapter" data-level="5.1" data-path="getting-started.html"><a href="getting-started.html#checklist-before-the-course"><i class="fa fa-check"></i><b>5.1</b> Checklist (before the course)</a></li>
<li class="chapter" data-level="5.2" data-path="getting-started.html"><a href="getting-started.html#support-and-resources"><i class="fa fa-check"></i><b>5.2</b> Support and resources</a></li>
<li class="chapter" data-level="5.3" data-path="getting-started.html"><a href="getting-started.html#installing-and-loading-the-required-r-packages"><i class="fa fa-check"></i><b>5.3</b> Installing and loading the required R packages</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproducible-reporting-with-rmarkdown.html"><a href="reproducible-reporting-with-rmarkdown.html"><i class="fa fa-check"></i><b>6</b> Reproducible reporting with Rmarkdown</a></li>
<li class="chapter" data-level="7" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html"><i class="fa fa-check"></i><b>7</b> Importing microbiome data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#data-access"><i class="fa fa-check"></i><b>7.1</b> Data access</a></li>
<li class="chapter" data-level="7.2" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#importing-microbiome-data-in-r"><i class="fa fa-check"></i><b>7.2</b> Importing microbiome data in R</a></li>
<li class="chapter" data-level="7.3" data-path="importing-microbiome-data.html"><a href="importing-microbiome-data.html#example-solutions"><i class="fa fa-check"></i><b>7.3</b> Example solutions</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html"><i class="fa fa-check"></i><b>8</b> Microbiome data exploration</a>
<ul>
<li class="chapter" data-level="8.1" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#data-structure"><i class="fa fa-check"></i><b>8.1</b> Data structure</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#transformations"><i class="fa fa-check"></i><b>8.1.1</b> Transformations</a></li>
<li class="chapter" data-level="8.1.2" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#aggregation"><i class="fa fa-check"></i><b>8.1.2</b> Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#visualization"><i class="fa fa-check"></i><b>8.2</b> Visualization</a></li>
<li class="chapter" data-level="8.3" data-path="microbiome-data-exploration.html"><a href="microbiome-data-exploration.html#exercises-optional"><i class="fa fa-check"></i><b>8.3</b> Exercises (optional)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="alpha-diversity.html"><a href="alpha-diversity.html"><i class="fa fa-check"></i><b>9</b> Alpha diversity</a>
<ul>
<li class="chapter" data-level="9.1" data-path="alpha-diversity.html"><a href="alpha-diversity.html#visualization-1"><i class="fa fa-check"></i><b>9.1</b> Visualization</a></li>
<li class="chapter" data-level="9.2" data-path="alpha-diversity.html"><a href="alpha-diversity.html#statistical-testing-and-comparisons"><i class="fa fa-check"></i><b>9.2</b> Statistical testing and comparisons</a></li>
<li class="chapter" data-level="9.3" data-path="alpha-diversity.html"><a href="alpha-diversity.html#exercises"><i class="fa fa-check"></i><b>9.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="beta-diversity.html"><a href="beta-diversity.html"><i class="fa fa-check"></i><b>10</b> Beta diversity</a>
<ul>
<li class="chapter" data-level="10.1" data-path="beta-diversity.html"><a href="beta-diversity.html#examples-of-pcoa-with-different-settings"><i class="fa fa-check"></i><b>10.1</b> Examples of PCoA with different settings</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-for-asv-level-data-with-bray-curtis"><i class="fa fa-check"></i><b>10.1.1</b> PCoA for ASV-level data with Bray-Curtis</a></li>
<li class="chapter" data-level="10.1.2" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-for-asv-level-data-with-aitchison-distance"><i class="fa fa-check"></i><b>10.1.2</b> PCoA for ASV-level data with Aitchison distance</a></li>
<li class="chapter" data-level="10.1.3" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-aggregated-to-phylum-level"><i class="fa fa-check"></i><b>10.1.3</b> PCoA aggregated to Phylum level</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="beta-diversity.html"><a href="beta-diversity.html#highlighting-external-variables"><i class="fa fa-check"></i><b>10.2</b> Highlighting external variables</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="beta-diversity.html"><a href="beta-diversity.html#discrete-grouping-variable-shown-with-colors"><i class="fa fa-check"></i><b>10.2.1</b> Discrete grouping variable shown with colors</a></li>
<li class="chapter" data-level="10.2.2" data-path="beta-diversity.html"><a href="beta-diversity.html#pcoa-plot-with-continuous-variable"><i class="fa fa-check"></i><b>10.2.2</b> PCoA plot with continuous variable</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="beta-diversity.html"><a href="beta-diversity.html#estimating-associations-with-an-external-variable"><i class="fa fa-check"></i><b>10.3</b> Estimating associations with an external variable</a></li>
<li class="chapter" data-level="10.4" data-path="beta-diversity.html"><a href="beta-diversity.html#community-typing"><i class="fa fa-check"></i><b>10.4</b> Community typing</a></li>
<li class="chapter" data-level="10.5" data-path="beta-diversity.html"><a href="beta-diversity.html#exercises-1"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html"><i class="fa fa-check"></i><b>11</b> Differential abundance analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#wilcoxon-test"><i class="fa fa-check"></i><b>11.1</b> Wilcoxon test</a></li>
<li class="chapter" data-level="11.2" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#ancom-bc"><i class="fa fa-check"></i><b>11.2</b> ANCOM-BC</a></li>
<li class="chapter" data-level="11.3" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#comparison-of-the-methods"><i class="fa fa-check"></i><b>11.3</b> Comparison of the methods</a></li>
<li class="chapter" data-level="11.4" data-path="differential-abundance-analysis.html"><a href="differential-abundance-analysis.html#comparison-of-abundance"><i class="fa fa-check"></i><b>11.4</b> Comparison of abundance</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="study-material.html"><a href="study-material.html"><i class="fa fa-check"></i><b>12</b> Study material</a>
<ul>
<li class="chapter" data-level="12.1" data-path="study-material.html"><a href="study-material.html#lecture-slides"><i class="fa fa-check"></i><b>12.1</b> Lecture slides</a></li>
<li class="chapter" data-level="12.2" data-path="study-material.html"><a href="study-material.html#r-programming-resources"><i class="fa fa-check"></i><b>12.2</b> R programming resources</a></li>
<li class="chapter" data-level="12.3" data-path="study-material.html"><a href="study-material.html#resources-for-treesummarizedexperiment"><i class="fa fa-check"></i><b>12.3</b> Resources for TreeSummarizedExperiment</a></li>
<li class="chapter" data-level="12.4" data-path="study-material.html"><a href="study-material.html#resources-for-phyloseq"><i class="fa fa-check"></i><b>12.4</b> Resources for phyloseq</a></li>
<li class="chapter" data-level="12.5" data-path="study-material.html"><a href="study-material.html#further-reading"><i class="fa fa-check"></i><b>12.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="additional-community-typing.html"><a href="additional-community-typing.html"><i class="fa fa-check"></i><b>13</b> Additional Community Typing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#community-composition"><i class="fa fa-check"></i><b>13.1</b> Community composition</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#composition-barplot"><i class="fa fa-check"></i><b>13.1.1</b> Composition barplot</a></li>
<li class="chapter" data-level="13.1.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#composition-heatmap"><i class="fa fa-check"></i><b>13.1.2</b> Composition heatmap</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#cluster-into-csts"><i class="fa fa-check"></i><b>13.2</b> Cluster into CSTs</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#elbow-method"><i class="fa fa-check"></i><b>13.2.1</b> Elbow Method</a></li>
<li class="chapter" data-level="13.2.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#silhouette-method"><i class="fa fa-check"></i><b>13.2.2</b> Silhouette Method</a></li>
<li class="chapter" data-level="13.2.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#gap-statistic-method"><i class="fa fa-check"></i><b>13.2.3</b> Gap-Statistic Method</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#holmes-and-mcmurdie-workflow"><i class="fa fa-check"></i><b>13.3</b> Holmes and McMurdie Workflow</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="additional-community-typing.html"><a href="additional-community-typing.html#jensen-shannon-distance"><i class="fa fa-check"></i><b>13.3.1</b> Jensen-Shannon Distance</a></li>
<li class="chapter" data-level="13.3.2" data-path="additional-community-typing.html"><a href="additional-community-typing.html#nonmetric-multidimensional-scaling"><i class="fa fa-check"></i><b>13.3.2</b> NonMetric Multidimensional Scaling</a></li>
<li class="chapter" data-level="13.3.3" data-path="additional-community-typing.html"><a href="additional-community-typing.html#chi-squared-correspondence-results"><i class="fa fa-check"></i><b>13.3.3</b> Chi-Squared Correspondence Results</a></li>
<li class="chapter" data-level="13.3.4" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bray-curtis-mds"><i class="fa fa-check"></i><b>13.3.4</b> Bray-Curtis MDS</a></li>
<li class="chapter" data-level="13.3.5" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bray-curtis-nmds"><i class="fa fa-check"></i><b>13.3.5</b> Bray-Curtis NMDS</a></li>
<li class="chapter" data-level="13.3.6" data-path="additional-community-typing.html"><a href="additional-community-typing.html#other-distances-from-the-philentropy-package"><i class="fa fa-check"></i><b>13.3.6</b> Other distances from the Philentropy package</a></li>
<li class="chapter" data-level="13.3.7" data-path="additional-community-typing.html"><a href="additional-community-typing.html#add-a-clustering-variable"><i class="fa fa-check"></i><b>13.3.7</b> Add a Clustering Variable</a></li>
<li class="chapter" data-level="13.3.8" data-path="additional-community-typing.html"><a href="additional-community-typing.html#more-clustering"><i class="fa fa-check"></i><b>13.3.8</b> More Clustering</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="additional-community-typing.html"><a href="additional-community-typing.html#cst-analysis"><i class="fa fa-check"></i><b>13.4</b> CST Analysis</a></li>
<li class="chapter" data-level="13.5" data-path="additional-community-typing.html"><a href="additional-community-typing.html#session-info"><i class="fa fa-check"></i><b>13.5</b> Session Info</a></li>
<li class="chapter" data-level="13.6" data-path="additional-community-typing.html"><a href="additional-community-typing.html#bibliography"><i class="fa fa-check"></i><b>13.6</b> Bibliography</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="exercise-solutions.html"><a href="exercise-solutions.html"><i class="fa fa-check"></i><b>14</b> Exercise Solutions</a>
<ul>
<li class="chapter" data-level="14.1" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-5"><i class="fa fa-check"></i><b>14.1</b> Section 5</a></li>
<li class="chapter" data-level="14.2" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-6"><i class="fa fa-check"></i><b>14.2</b> Section 6</a></li>
<li class="chapter" data-level="14.3" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-7"><i class="fa fa-check"></i><b>14.3</b> Section 7</a></li>
<li class="chapter" data-level="14.4" data-path="exercise-solutions.html"><a href="exercise-solutions.html#section-8"><i class="fa fa-check"></i><b>14.4</b> Section 8</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="tutorial-aims.html"><a href="tutorial-aims.html"><i class="fa fa-check"></i><b>15</b> Tutorial Aims</a></li>
<li class="chapter" data-level="16" data-path="lab-1.html"><a href="lab-1.html"><i class="fa fa-check"></i><b>16</b> Lab 1</a>
<ul>
<li class="chapter" data-level="16.1" data-path="lab-1.html"><a href="lab-1.html#unsupervised-learning-feature-selection-dimension-reduction"><i class="fa fa-check"></i><b>16.1</b> unsupervised learning: Feature selection &amp; dimension reduction</a></li>
<li class="chapter" data-level="16.2" data-path="lab-1.html"><a href="lab-1.html#load-the-data"><i class="fa fa-check"></i><b>16.2</b> Load the data</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="lab-2.html"><a href="lab-2.html"><i class="fa fa-check"></i><b>17</b> Lab 2</a>
<ul>
<li class="chapter" data-level="17.1" data-path="lab-2.html"><a href="lab-2.html#unsupervised-learning-clustering-visualization"><i class="fa fa-check"></i><b>17.1</b> unsupervised learning: clustering &amp; visualization</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="lab-3.html"><a href="lab-3.html"><i class="fa fa-check"></i><b>18</b> Lab 3</a>
<ul>
<li class="chapter" data-level="18.1" data-path="lab-3.html"><a href="lab-3.html#unsupervised-learninganalysis-and-interpretation"><i class="fa fa-check"></i><b>18.1</b> unsupervised learning:Analysis and interpretation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Multi-omic data science with R/Bioconductor</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beta-diversity" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Beta diversity</h1>
<p>Beta diversity is another name for sample dissimilarity. It quantifies
differences in the overall taxonomic composition between two samples.</p>
<p>Common indices include Bray-Curtis, Unifrac, Jaccard index, and the
Aitchison distance. Each of these (dis)similarity measures emphasizes
different aspects. For example, UniFrac incorporates phylogenetic
information, and Jaccard index ignores exact abundances and considers
only presence/absence values. For more background information
and examples, you can check the dedicated section in <a href="https://microbiome.github.io/OMA/microbiome-diversity.html#beta-diversity">online
book</a>.</p>
<div id="examples-of-pcoa-with-different-settings" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Examples of PCoA with different settings</h2>
<p>Beta diversity estimation generates a (dis)similarity matrix that
contains for each sample (rows) the dissimilarity to any other sample
(columns).</p>
<p>This complex set of pairwise relations can be visualized in
informative ways, and even coupled with other explanatory
variables. As a first step, we compress the information to a lower
dimensionality, or fewer principal components, and then visualize
sample similarity based on that using ordination techniques, such as
Principal Coordinate Analysis (PCoA). PCoA is a non-linear dimension
reduction technique, and with Euclidean distances it is is identical
to the linear PCA (except for potential scaling).</p>
<p>We typically retain just the two (or three) most informative top
components, and ignore the other information. Each sample has a score
on each of these components, and each component measures the variation
across a set of correlated taxa. The top components are then easily
visualized on a two (or three) dimensional display.</p>
<p>Let us next look at some concrete examples.</p>
<div id="pcoa-for-asv-level-data-with-bray-curtis" class="section level3" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> PCoA for ASV-level data with Bray-Curtis</h3>
<p>Let us start with PCoA based on a Bray-Curtis dissimilarity matrix
calculated at Genus level abundances.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="beta-diversity.html#cb150-1" aria-hidden="true"></a><span class="co"># Pick the relative abundance table</span></span>
<span id="cb150-2"><a href="beta-diversity.html#cb150-2" aria-hidden="true"></a>rel_abund_assay &lt;-<span class="st"> </span><span class="kw">assays</span>(tse)<span class="op">$</span>relabundance</span>
<span id="cb150-3"><a href="beta-diversity.html#cb150-3" aria-hidden="true"></a></span>
<span id="cb150-4"><a href="beta-diversity.html#cb150-4" aria-hidden="true"></a><span class="co"># Calculates Bray-Curtis distances between samples. Because taxa is in</span></span>
<span id="cb150-5"><a href="beta-diversity.html#cb150-5" aria-hidden="true"></a><span class="co"># columns, it is used to compare different samples. We transpose the</span></span>
<span id="cb150-6"><a href="beta-diversity.html#cb150-6" aria-hidden="true"></a><span class="co"># assay to get taxa to columns</span></span>
<span id="cb150-7"><a href="beta-diversity.html#cb150-7" aria-hidden="true"></a>bray_curtis_dist &lt;-<span class="st"> </span>vegan<span class="op">::</span><span class="kw">vegdist</span>(<span class="kw">t</span>(rel_abund_assay), <span class="dt">method =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb150-8"><a href="beta-diversity.html#cb150-8" aria-hidden="true"></a></span>
<span id="cb150-9"><a href="beta-diversity.html#cb150-9" aria-hidden="true"></a><span class="co"># PCoA</span></span>
<span id="cb150-10"><a href="beta-diversity.html#cb150-10" aria-hidden="true"></a>bray_curtis_pcoa &lt;-<span class="st"> </span>ecodist<span class="op">::</span><span class="kw">pco</span>(bray_curtis_dist)</span>
<span id="cb150-11"><a href="beta-diversity.html#cb150-11" aria-hidden="true"></a></span>
<span id="cb150-12"><a href="beta-diversity.html#cb150-12" aria-hidden="true"></a><span class="co"># All components could be found here: </span></span>
<span id="cb150-13"><a href="beta-diversity.html#cb150-13" aria-hidden="true"></a><span class="co"># bray_curtis_pcoa$vectors</span></span>
<span id="cb150-14"><a href="beta-diversity.html#cb150-14" aria-hidden="true"></a><span class="co"># But we only need the first two to demonstrate what we can do:</span></span>
<span id="cb150-15"><a href="beta-diversity.html#cb150-15" aria-hidden="true"></a>bray_curtis_pcoa_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">pcoa1 =</span> bray_curtis_pcoa<span class="op">$</span>vectors[,<span class="dv">1</span>], </span>
<span id="cb150-16"><a href="beta-diversity.html#cb150-16" aria-hidden="true"></a>                                  <span class="dt">pcoa2 =</span> bray_curtis_pcoa<span class="op">$</span>vectors[,<span class="dv">2</span>])</span>
<span id="cb150-17"><a href="beta-diversity.html#cb150-17" aria-hidden="true"></a></span>
<span id="cb150-18"><a href="beta-diversity.html#cb150-18" aria-hidden="true"></a><span class="co"># Create a plot</span></span>
<span id="cb150-19"><a href="beta-diversity.html#cb150-19" aria-hidden="true"></a>bray_curtis_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> bray_curtis_pcoa_df, <span class="kw">aes</span>(<span class="dt">x=</span>pcoa1, <span class="dt">y=</span>pcoa2)) <span class="op">+</span></span>
<span id="cb150-20"><a href="beta-diversity.html#cb150-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb150-21"><a href="beta-diversity.html#cb150-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>,</span>
<span id="cb150-22"><a href="beta-diversity.html#cb150-22" aria-hidden="true"></a>       <span class="dt">y =</span> <span class="st">&quot;PC2&quot;</span>, </span>
<span id="cb150-23"><a href="beta-diversity.html#cb150-23" aria-hidden="true"></a>       <span class="dt">title =</span> <span class="st">&quot;Bray-Curtis PCoA&quot;</span>) <span class="op">+</span></span>
<span id="cb150-24"><a href="beta-diversity.html#cb150-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>)) <span class="co"># makes titles smaller</span></span>
<span id="cb150-25"><a href="beta-diversity.html#cb150-25" aria-hidden="true"></a></span>
<span id="cb150-26"><a href="beta-diversity.html#cb150-26" aria-hidden="true"></a>bray_curtis_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/pcoa_asv_bc-1.png" width="672" /></p>
</div>
<div id="pcoa-for-asv-level-data-with-aitchison-distance" class="section level3" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> PCoA for ASV-level data with Aitchison distance</h3>
<p>Now the same using Aitchison distance. This metric corresponds to
Euclidean distances between CLR transformed sample abundance vectors.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="beta-diversity.html#cb151-1" aria-hidden="true"></a><span class="co"># Does clr transformation. Pseudocount is added, because data contains zeros. </span></span>
<span id="cb151-2"><a href="beta-diversity.html#cb151-2" aria-hidden="true"></a>tse &lt;-<span class="st"> </span><span class="kw">transformCounts</span>(tse, <span class="dt">method =</span> <span class="st">&quot;clr&quot;</span>, <span class="dt">pseudocount =</span> <span class="dv">1</span>)</span>
<span id="cb151-3"><a href="beta-diversity.html#cb151-3" aria-hidden="true"></a></span>
<span id="cb151-4"><a href="beta-diversity.html#cb151-4" aria-hidden="true"></a><span class="co"># Gets clr table</span></span>
<span id="cb151-5"><a href="beta-diversity.html#cb151-5" aria-hidden="true"></a>clr_assay &lt;-<span class="st"> </span><span class="kw">assays</span>(tse)<span class="op">$</span>clr</span>
<span id="cb151-6"><a href="beta-diversity.html#cb151-6" aria-hidden="true"></a></span>
<span id="cb151-7"><a href="beta-diversity.html#cb151-7" aria-hidden="true"></a><span class="co"># Transposes it to get taxa to columns</span></span>
<span id="cb151-8"><a href="beta-diversity.html#cb151-8" aria-hidden="true"></a>clr_assay &lt;-<span class="st"> </span><span class="kw">t</span>(clr_assay)</span>
<span id="cb151-9"><a href="beta-diversity.html#cb151-9" aria-hidden="true"></a></span>
<span id="cb151-10"><a href="beta-diversity.html#cb151-10" aria-hidden="true"></a><span class="co"># Calculates Euclidean distances between samples. Because taxa is in columns,</span></span>
<span id="cb151-11"><a href="beta-diversity.html#cb151-11" aria-hidden="true"></a><span class="co"># it is used to compare different samples.</span></span>
<span id="cb151-12"><a href="beta-diversity.html#cb151-12" aria-hidden="true"></a>euclidean_dist &lt;-<span class="st"> </span>vegan<span class="op">::</span><span class="kw">vegdist</span>(clr_assay, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</span>
<span id="cb151-13"><a href="beta-diversity.html#cb151-13" aria-hidden="true"></a></span>
<span id="cb151-14"><a href="beta-diversity.html#cb151-14" aria-hidden="true"></a><span class="co"># Does principal coordinate analysis</span></span>
<span id="cb151-15"><a href="beta-diversity.html#cb151-15" aria-hidden="true"></a>euclidean_pcoa &lt;-<span class="st"> </span>ecodist<span class="op">::</span><span class="kw">pco</span>(euclidean_dist)</span>
<span id="cb151-16"><a href="beta-diversity.html#cb151-16" aria-hidden="true"></a></span>
<span id="cb151-17"><a href="beta-diversity.html#cb151-17" aria-hidden="true"></a><span class="co"># Creates a data frame from principal coordinates</span></span>
<span id="cb151-18"><a href="beta-diversity.html#cb151-18" aria-hidden="true"></a>euclidean_pcoa_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">pcoa1 =</span> euclidean_pcoa<span class="op">$</span>vectors[,<span class="dv">1</span>], </span>
<span id="cb151-19"><a href="beta-diversity.html#cb151-19" aria-hidden="true"></a>                                <span class="dt">pcoa2 =</span> euclidean_pcoa<span class="op">$</span>vectors[,<span class="dv">2</span>])</span>
<span id="cb151-20"><a href="beta-diversity.html#cb151-20" aria-hidden="true"></a></span>
<span id="cb151-21"><a href="beta-diversity.html#cb151-21" aria-hidden="true"></a><span class="co"># Creates the plot</span></span>
<span id="cb151-22"><a href="beta-diversity.html#cb151-22" aria-hidden="true"></a>euclidean_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> euclidean_pcoa_df, <span class="kw">aes</span>(<span class="dt">x=</span>pcoa1, <span class="dt">y=</span>pcoa2)) <span class="op">+</span></span>
<span id="cb151-23"><a href="beta-diversity.html#cb151-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb151-24"><a href="beta-diversity.html#cb151-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>,</span>
<span id="cb151-25"><a href="beta-diversity.html#cb151-25" aria-hidden="true"></a>       <span class="dt">y =</span> <span class="st">&quot;PC2&quot;</span>,</span>
<span id="cb151-26"><a href="beta-diversity.html#cb151-26" aria-hidden="true"></a>       <span class="dt">title =</span> <span class="st">&quot;Euclidean PCoA with CLR transformation&quot;</span>) <span class="op">+</span></span>
<span id="cb151-27"><a href="beta-diversity.html#cb151-27" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)) <span class="co"># makes titles smaller</span></span>
<span id="cb151-28"><a href="beta-diversity.html#cb151-28" aria-hidden="true"></a></span>
<span id="cb151-29"><a href="beta-diversity.html#cb151-29" aria-hidden="true"></a>euclidean_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/pcoa_asv_aitchison-1.png" width="672" /></p>
</div>
<div id="pcoa-aggregated-to-phylum-level" class="section level3" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> PCoA aggregated to Phylum level</h3>
<p>We use again the Aitchison distances in this example but this time applied to the phylum level.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="beta-diversity.html#cb152-1" aria-hidden="true"></a><span class="co"># Does clr transformation. Psuedocount is added, because data contains zeros. </span></span>
<span id="cb152-2"><a href="beta-diversity.html#cb152-2" aria-hidden="true"></a>tse_phylum &lt;-<span class="st"> </span><span class="kw">transformCounts</span>(tse_phylum, <span class="dt">method =</span> <span class="st">&quot;clr&quot;</span>, <span class="dt">pseudocount =</span> <span class="dv">1</span>)</span>
<span id="cb152-3"><a href="beta-diversity.html#cb152-3" aria-hidden="true"></a></span>
<span id="cb152-4"><a href="beta-diversity.html#cb152-4" aria-hidden="true"></a><span class="co"># Gets clr table</span></span>
<span id="cb152-5"><a href="beta-diversity.html#cb152-5" aria-hidden="true"></a>clr_phylum_assay &lt;-<span class="st"> </span><span class="kw">assays</span>(tse_phylum)<span class="op">$</span>clr</span>
<span id="cb152-6"><a href="beta-diversity.html#cb152-6" aria-hidden="true"></a></span>
<span id="cb152-7"><a href="beta-diversity.html#cb152-7" aria-hidden="true"></a><span class="co"># Transposes it to get taxa to columns</span></span>
<span id="cb152-8"><a href="beta-diversity.html#cb152-8" aria-hidden="true"></a>clr_phylum_assay &lt;-<span class="st"> </span><span class="kw">t</span>(clr_phylum_assay)</span>
<span id="cb152-9"><a href="beta-diversity.html#cb152-9" aria-hidden="true"></a></span>
<span id="cb152-10"><a href="beta-diversity.html#cb152-10" aria-hidden="true"></a><span class="co"># Calculates Euclidean distances between samples. Because taxa is in columns,</span></span>
<span id="cb152-11"><a href="beta-diversity.html#cb152-11" aria-hidden="true"></a><span class="co"># it is used to compare different samples.</span></span>
<span id="cb152-12"><a href="beta-diversity.html#cb152-12" aria-hidden="true"></a>euclidean_phylum_dist &lt;-<span class="st"> </span>vegan<span class="op">::</span><span class="kw">vegdist</span>(clr_assay, <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)</span>
<span id="cb152-13"><a href="beta-diversity.html#cb152-13" aria-hidden="true"></a></span>
<span id="cb152-14"><a href="beta-diversity.html#cb152-14" aria-hidden="true"></a><span class="co"># Does principal coordinate analysis</span></span>
<span id="cb152-15"><a href="beta-diversity.html#cb152-15" aria-hidden="true"></a>euclidean_phylum_pcoa &lt;-<span class="st"> </span>ecodist<span class="op">::</span><span class="kw">pco</span>(euclidean_phylum_dist)</span>
<span id="cb152-16"><a href="beta-diversity.html#cb152-16" aria-hidden="true"></a></span>
<span id="cb152-17"><a href="beta-diversity.html#cb152-17" aria-hidden="true"></a><span class="co"># Creates a data frame from principal coordinates</span></span>
<span id="cb152-18"><a href="beta-diversity.html#cb152-18" aria-hidden="true"></a>euclidean_phylum_pcoa_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb152-19"><a href="beta-diversity.html#cb152-19" aria-hidden="true"></a>  <span class="dt">pcoa1 =</span> euclidean_phylum_pcoa<span class="op">$</span>vectors[,<span class="dv">1</span>], </span>
<span id="cb152-20"><a href="beta-diversity.html#cb152-20" aria-hidden="true"></a>  <span class="dt">pcoa2 =</span> euclidean_phylum_pcoa<span class="op">$</span>vectors[,<span class="dv">2</span>])</span>
<span id="cb152-21"><a href="beta-diversity.html#cb152-21" aria-hidden="true"></a></span>
<span id="cb152-22"><a href="beta-diversity.html#cb152-22" aria-hidden="true"></a><span class="co"># Creates a plot</span></span>
<span id="cb152-23"><a href="beta-diversity.html#cb152-23" aria-hidden="true"></a>euclidean_phylum_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> euclidean_phylum_pcoa_df,</span>
<span id="cb152-24"><a href="beta-diversity.html#cb152-24" aria-hidden="true"></a>  <span class="kw">aes</span>(<span class="dt">x=</span>pcoa1, <span class="dt">y=</span>pcoa2)) <span class="op">+</span></span>
<span id="cb152-25"><a href="beta-diversity.html#cb152-25" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb152-26"><a href="beta-diversity.html#cb152-26" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>,</span>
<span id="cb152-27"><a href="beta-diversity.html#cb152-27" aria-hidden="true"></a>       <span class="dt">y =</span> <span class="st">&quot;PC2&quot;</span>,</span>
<span id="cb152-28"><a href="beta-diversity.html#cb152-28" aria-hidden="true"></a>       <span class="dt">title =</span> <span class="st">&quot;Aitchison distances at Phylum level&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb152-29"><a href="beta-diversity.html#cb152-29" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)) <span class="co"># makes titles smaller</span></span>
<span id="cb152-30"><a href="beta-diversity.html#cb152-30" aria-hidden="true"></a></span>
<span id="cb152-31"><a href="beta-diversity.html#cb152-31" aria-hidden="true"></a>euclidean_phylum_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/pcoa_phylum_aitchison-1.png" width="672" /></p>
</div>
</div>
<div id="highlighting-external-variables" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Highlighting external variables</h2>
<p>We can map other variables on the same plot for example by coloring
the points accordingly.</p>
<div id="discrete-grouping-variable-shown-with-colors" class="section level3" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Discrete grouping variable shown with colors</h3>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="beta-diversity.html#cb153-1" aria-hidden="true"></a><span class="co"># Adds the variable we later use for coloring to the data frame</span></span>
<span id="cb153-2"><a href="beta-diversity.html#cb153-2" aria-hidden="true"></a>euclidean_patient_status_pcoa_df &lt;-<span class="st"> </span><span class="kw">cbind</span>(euclidean_pcoa_df,</span>
<span id="cb153-3"><a href="beta-diversity.html#cb153-3" aria-hidden="true"></a>                             <span class="dt">patient_status =</span> <span class="kw">colData</span>(tse)<span class="op">$</span>patient_status)</span>
<span id="cb153-4"><a href="beta-diversity.html#cb153-4" aria-hidden="true"></a></span>
<span id="cb153-5"><a href="beta-diversity.html#cb153-5" aria-hidden="true"></a><span class="co"># Creates a plot</span></span>
<span id="cb153-6"><a href="beta-diversity.html#cb153-6" aria-hidden="true"></a>euclidean_patient_status_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> euclidean_patient_status_pcoa_df, </span>
<span id="cb153-7"><a href="beta-diversity.html#cb153-7" aria-hidden="true"></a>                                        <span class="kw">aes</span>(<span class="dt">x=</span>pcoa1, <span class="dt">y=</span>pcoa2,</span>
<span id="cb153-8"><a href="beta-diversity.html#cb153-8" aria-hidden="true"></a>                                            <span class="dt">color =</span> patient_status)) <span class="op">+</span></span>
<span id="cb153-9"><a href="beta-diversity.html#cb153-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb153-10"><a href="beta-diversity.html#cb153-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>,</span>
<span id="cb153-11"><a href="beta-diversity.html#cb153-11" aria-hidden="true"></a>       <span class="dt">y =</span> <span class="st">&quot;PC2&quot;</span>,</span>
<span id="cb153-12"><a href="beta-diversity.html#cb153-12" aria-hidden="true"></a>       <span class="dt">title =</span> <span class="st">&quot;PCoA with Aitchison distances&quot;</span>) <span class="op">+</span></span>
<span id="cb153-13"><a href="beta-diversity.html#cb153-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>)) <span class="co"># makes titles smaller</span></span>
<span id="cb153-14"><a href="beta-diversity.html#cb153-14" aria-hidden="true"></a></span>
<span id="cb153-15"><a href="beta-diversity.html#cb153-15" aria-hidden="true"></a>euclidean_patient_status_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/pcoa_genus-1.png" width="672" /></p>
</div>
<div id="pcoa-plot-with-continuous-variable" class="section level3" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> PCoA plot with continuous variable</h3>
<p>We can also overlay a continuous variable on a PCoA plot. E.g. let us
use the alcohol study dataset from <a href="https://bioconductor.org/packages/release/data/experiment/vignettes/curatedMetagenomicData/inst/doc/curatedMetagenomicData.html">curatedMetagenomicData</a>.
Perform PCoA and use the BMI as our continuous variable:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="beta-diversity.html#cb154-1" aria-hidden="true"></a><span class="co"># Retrieving data as a TreeSummarizedExperiment object, and agglomerating to a genus level.</span></span>
<span id="cb154-2"><a href="beta-diversity.html#cb154-2" aria-hidden="true"></a><span class="kw">library</span>(curatedMetagenomicData)</span>
<span id="cb154-3"><a href="beta-diversity.html#cb154-3" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb154-4"><a href="beta-diversity.html#cb154-4" aria-hidden="true"></a><span class="kw">library</span>(DT)</span>
<span id="cb154-5"><a href="beta-diversity.html#cb154-5" aria-hidden="true"></a><span class="co"># Querying the data</span></span>
<span id="cb154-6"><a href="beta-diversity.html#cb154-6" aria-hidden="true"></a>tse_data &lt;-<span class="st"> </span>sampleMetadata <span class="op">%&gt;%</span></span>
<span id="cb154-7"><a href="beta-diversity.html#cb154-7" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(age <span class="op">&gt;=</span><span class="st"> </span><span class="dv">18</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># taking only data of age 18 or above</span></span>
<span id="cb154-8"><a href="beta-diversity.html#cb154-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(alcohol)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># excluding missing values</span></span>
<span id="cb154-9"><a href="beta-diversity.html#cb154-9" aria-hidden="true"></a><span class="st">    </span><span class="kw">returnSamples</span>(<span class="st">&quot;relative_abundance&quot;</span>)</span>
<span id="cb154-10"><a href="beta-diversity.html#cb154-10" aria-hidden="true"></a></span>
<span id="cb154-11"><a href="beta-diversity.html#cb154-11" aria-hidden="true"></a><span class="co"># Agglomeration</span></span>
<span id="cb154-12"><a href="beta-diversity.html#cb154-12" aria-hidden="true"></a>tse_genus &lt;-<span class="st"> </span><span class="kw">agglomerateByRank</span>(tse_data, <span class="dt">rank=</span><span class="st">&quot;genus&quot;</span>)</span></code></pre></div>
<p>Performing PCoA with Bray-Curtis dissimilarity.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="beta-diversity.html#cb155-1" aria-hidden="true"></a><span class="kw">library</span>(scater)</span></code></pre></div>
<pre><code>## Loading required package: scuttle</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="beta-diversity.html#cb157-1" aria-hidden="true"></a>tse_genus &lt;-<span class="st"> </span><span class="kw">runMDS</span>(tse_genus, <span class="dt">FUN =</span> vegan<span class="op">::</span>vegdist,</span>
<span id="cb157-2"><a href="beta-diversity.html#cb157-2" aria-hidden="true"></a>              <span class="dt">name =</span> <span class="st">&quot;PCoA_BC&quot;</span>, <span class="dt">exprs_values =</span> <span class="st">&quot;relative_abundance&quot;</span>)</span>
<span id="cb157-3"><a href="beta-diversity.html#cb157-3" aria-hidden="true"></a></span>
<span id="cb157-4"><a href="beta-diversity.html#cb157-4" aria-hidden="true"></a><span class="co"># Retrieving the explained variance</span></span>
<span id="cb157-5"><a href="beta-diversity.html#cb157-5" aria-hidden="true"></a>e &lt;-<span class="st"> </span><span class="kw">attr</span>(<span class="kw">reducedDim</span>(tse_genus, <span class="st">&quot;PCoA_BC&quot;</span>), <span class="st">&quot;eig&quot;</span>);</span>
<span id="cb157-6"><a href="beta-diversity.html#cb157-6" aria-hidden="true"></a>var_explained &lt;-<span class="st"> </span>e<span class="op">/</span><span class="kw">sum</span>(e[e<span class="op">&gt;</span><span class="dv">0</span>])<span class="op">*</span><span class="dv">100</span></span>
<span id="cb157-7"><a href="beta-diversity.html#cb157-7" aria-hidden="true"></a></span>
<span id="cb157-8"><a href="beta-diversity.html#cb157-8" aria-hidden="true"></a><span class="co"># Visualization</span></span>
<span id="cb157-9"><a href="beta-diversity.html#cb157-9" aria-hidden="true"></a>plot &lt;-<span class="kw">plotReducedDim</span>(tse_genus,<span class="st">&quot;PCoA_BC&quot;</span>, <span class="dt">colour_by =</span> <span class="st">&quot;BMI&quot;</span>)<span class="op">+</span></span>
<span id="cb157-10"><a href="beta-diversity.html#cb157-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="kw">paste</span>(<span class="st">&quot;PC1 (&quot;</span>,<span class="kw">round</span>(var_explained[<span class="dv">1</span>],<span class="dv">1</span>),<span class="st">&quot;%)&quot;</span>),</span>
<span id="cb157-11"><a href="beta-diversity.html#cb157-11" aria-hidden="true"></a>       <span class="dt">y=</span><span class="kw">paste</span>(<span class="st">&quot;PC2 (&quot;</span>,<span class="kw">round</span>(var_explained[<span class="dv">2</span>],<span class="dv">1</span>),<span class="st">&quot;%)&quot;</span>),</span>
<span id="cb157-12"><a href="beta-diversity.html#cb157-12" aria-hidden="true"></a>       <span class="dt">color=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb157-13"><a href="beta-diversity.html#cb157-13" aria-hidden="true"></a>plot</span></code></pre></div>
<pre><code>## Warning in grid.Call.graphics(C_points, x$x, x$y, x$pch, x$size): semi-
## transparency is not supported on this device: reported only once per page</code></pre>
<p><img src="07-beta_files/figure-html/pcoa_coloring-1.png" width="672" /></p>
</div>
</div>
<div id="estimating-associations-with-an-external-variable" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Estimating associations with an external variable</h2>
<p>Next to visualizing whether any variable is associated with
differences between samples, we can also quantify the strength of the
association between community composition (beta diversity) and
external factors.</p>
<p>The standard way to do this is to perform a so-called permutational
multivariate analysis of variance (PERMANOVA). This method takes as
input the abundance table, which measure of distance you want to base
the test on and a formula that tells the model how you think the
variables are associated with each other.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="beta-diversity.html#cb159-1" aria-hidden="true"></a><span class="co"># First we get the relative abundance table</span></span>
<span id="cb159-2"><a href="beta-diversity.html#cb159-2" aria-hidden="true"></a>rel_abund_assay &lt;-<span class="st"> </span><span class="kw">assays</span>(tse)<span class="op">$</span>relabundance</span>
<span id="cb159-3"><a href="beta-diversity.html#cb159-3" aria-hidden="true"></a></span>
<span id="cb159-4"><a href="beta-diversity.html#cb159-4" aria-hidden="true"></a><span class="co"># again transpose it to get taxa to columns</span></span>
<span id="cb159-5"><a href="beta-diversity.html#cb159-5" aria-hidden="true"></a>rel_abund_assay &lt;-<span class="st"> </span><span class="kw">t</span>(rel_abund_assay)</span>
<span id="cb159-6"><a href="beta-diversity.html#cb159-6" aria-hidden="true"></a></span>
<span id="cb159-7"><a href="beta-diversity.html#cb159-7" aria-hidden="true"></a><span class="co"># then we can perform the method</span></span>
<span id="cb159-8"><a href="beta-diversity.html#cb159-8" aria-hidden="true"></a>permanova_cohort &lt;-<span class="st"> </span>vegan<span class="op">::</span><span class="kw">adonis</span>(rel_abund_assay <span class="op">~</span><span class="st"> </span>cohort,</span>
<span id="cb159-9"><a href="beta-diversity.html#cb159-9" aria-hidden="true"></a>                                  <span class="dt">data =</span> <span class="kw">colData</span>(tse),</span>
<span id="cb159-10"><a href="beta-diversity.html#cb159-10" aria-hidden="true"></a>                                  <span class="dt">permutations =</span> <span class="dv">9999</span>)</span></code></pre></div>
<pre><code>## Warning: &#39;vegan::adonis&#39; is deprecated.
## Use &#39;adonis2&#39; instead.
## See help(&quot;Deprecated&quot;) and help(&quot;vegan-deprecated&quot;).</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="beta-diversity.html#cb161-1" aria-hidden="true"></a><span class="co"># we can obtain a the p value for our predictor:</span></span>
<span id="cb161-2"><a href="beta-diversity.html#cb161-2" aria-hidden="true"></a><span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Different different cohorts and variance of abundance &quot;</span>,</span>
<span id="cb161-3"><a href="beta-diversity.html#cb161-3" aria-hidden="true"></a>              <span class="st">&quot;between samples, p-value: &quot;</span>, </span>
<span id="cb161-4"><a href="beta-diversity.html#cb161-4" aria-hidden="true"></a>              <span class="kw">as.data.frame</span>(permanova_cohort<span class="op">$</span>aov.tab)[<span class="st">&quot;cohort&quot;</span>, <span class="st">&quot;Pr(&gt;F)&quot;</span>]))</span></code></pre></div>
<pre><code>## [1] &quot;Different different cohorts and variance of abundance between samples, p-value: 0.7397&quot;</code></pre>
<p>The cohort variable is not significantly associated with
microbiota composition (p-value is over 0.05).</p>
<p>We can, however, visualize those taxa whose abundances drive the
differences between cohorts. We first need to extract the model
coefficients of taxa:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="beta-diversity.html#cb163-1" aria-hidden="true"></a><span class="co"># Gets the coefficients</span></span>
<span id="cb163-2"><a href="beta-diversity.html#cb163-2" aria-hidden="true"></a>coef &lt;-<span class="st"> </span><span class="kw">coefficients</span>(permanova_cohort)[<span class="st">&quot;cohort1&quot;</span>,]</span>
<span id="cb163-3"><a href="beta-diversity.html#cb163-3" aria-hidden="true"></a></span>
<span id="cb163-4"><a href="beta-diversity.html#cb163-4" aria-hidden="true"></a><span class="co"># Gets the highest coefficients</span></span>
<span id="cb163-5"><a href="beta-diversity.html#cb163-5" aria-hidden="true"></a>top.coef &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">head</span>(coef[<span class="kw">rev</span>(<span class="kw">order</span>(<span class="kw">abs</span>(coef)))],<span class="dv">20</span>))</span>
<span id="cb163-6"><a href="beta-diversity.html#cb163-6" aria-hidden="true"></a></span>
<span id="cb163-7"><a href="beta-diversity.html#cb163-7" aria-hidden="true"></a><span class="co"># Plots the coefficients</span></span>
<span id="cb163-8"><a href="beta-diversity.html#cb163-8" aria-hidden="true"></a>top_taxa_coeffient_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> top.coef,</span>
<span id="cb163-9"><a href="beta-diversity.html#cb163-9" aria-hidden="true"></a>                                             <span class="dt">y =</span> <span class="kw">factor</span>(<span class="kw">names</span>(top.coef),</span>
<span id="cb163-10"><a href="beta-diversity.html#cb163-10" aria-hidden="true"></a>                         <span class="kw">unique</span>(<span class="kw">names</span>(top.coef)))),</span>
<span id="cb163-11"><a href="beta-diversity.html#cb163-11" aria-hidden="true"></a>                                  <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></span>
<span id="cb163-12"><a href="beta-diversity.html#cb163-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></span>
<span id="cb163-13"><a href="beta-diversity.html#cb163-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Top Taxa&quot;</span>) <span class="op">+</span></span>
<span id="cb163-14"><a href="beta-diversity.html#cb163-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>()</span>
<span id="cb163-15"><a href="beta-diversity.html#cb163-15" aria-hidden="true"></a></span>
<span id="cb163-16"><a href="beta-diversity.html#cb163-16" aria-hidden="true"></a>top_taxa_coeffient_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/permanova_coefs-1.png" width="672" /></p>
<p>The above plot shows taxa as code names, and it is hard to tell which
bacterial groups they represent. However, it is easy to add human readable
names. We can fetch those from our rowData. Here we use Genus level names:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="beta-diversity.html#cb164-1" aria-hidden="true"></a><span class="co"># Gets corresponding Genus level names and stores them to top.coef</span></span>
<span id="cb164-2"><a href="beta-diversity.html#cb164-2" aria-hidden="true"></a>names &lt;-<span class="st"> </span><span class="kw">rowData</span>(tse)[<span class="kw">names</span>(top.coef), ][,<span class="st">&quot;Genus&quot;</span>]</span>
<span id="cb164-3"><a href="beta-diversity.html#cb164-3" aria-hidden="true"></a></span>
<span id="cb164-4"><a href="beta-diversity.html#cb164-4" aria-hidden="true"></a><span class="co"># Adds new labels to the plot</span></span>
<span id="cb164-5"><a href="beta-diversity.html#cb164-5" aria-hidden="true"></a>top_taxa_coeffient_plot &lt;-<span class="st"> </span>top_taxa_coeffient_plot <span class="op">+</span></span>
<span id="cb164-6"><a href="beta-diversity.html#cb164-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="dt">labels =</span> names) <span class="co"># Adds new labels</span></span>
<span id="cb164-7"><a href="beta-diversity.html#cb164-7" aria-hidden="true"></a>top_taxa_coeffient_plot</span></code></pre></div>
<p><img src="07-beta_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>There are many alternative and complementary methods for analysing
community composition. For more examples, see a dedicated section on
beta diversity in the <a href="https://microbiome.github.io/OMA/microbiome-diversity.html#beta-diversity">online
book</a>.</p>
</div>
<div id="community-typing" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Community typing</h2>
<p>A dedicated section presenting examples on community typing is in the
<a href="https://microbiome.github.io/OMA/microbiome-community.html#community-typing">online book</a>.</p>
</div>
<div id="exercises-1" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> Exercises</h2>
<ul>
<li><p>Visualize community variation with different methods (PCA, MDS, t-SNE…) by using the options in the alternative method, plotReducedDim <a href="https://microbiome.github.io/OMA/microbiome-diversity.html#estimating-beta-diversity">OMA</a>. Compare results obtained with different dissimilarities (Euclidean, Bray-Curtis, Unifrac..) and transformations (CLR, compositional..) of your own choice."</p></li>
<li><p>Investigate the influence of the data transformations on
statistical analysis: Visualize community variation with PCoA with
the following options: 1) Bray-Curtis distances for compositional
data; 2) Euclidean distances for CLR-transformed data.</p></li>
<li><p>Community-level comparisons: Use PERMANOVA to investigate whether
the community composition differs between two groups of individuals
(e.g. males and females, or some other grouping of your
choice). You can also include covariates such as age and gender,
and see how this affects the results.</p></li>
<li><p>Perform community typing for the data using the DMM method <a href="https://microbiome.github.io/OMA/microbiome-community.html#community-typing">OMA</a></p></li>
<li><p>Example <a href="08-5-ex-sol-ADHD.html">Solutions</a></p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="alpha-diversity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="differential-abundance-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["oulu2022_material.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
